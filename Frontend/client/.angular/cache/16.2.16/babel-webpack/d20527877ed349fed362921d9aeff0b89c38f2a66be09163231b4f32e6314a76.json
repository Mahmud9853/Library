{"ast":null,"code":"import * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/forms\";\nimport * as i2 from \"../home.service\";\nimport * as i3 from \"@angular/router\";\nimport * as i4 from \"@angular/common\";\nconst _c0 = function (a0) {\n  return {\n    \"active\": a0\n  };\n};\nfunction HomeEditComponent_div_16_div_5_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r5 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"div\", 16)(2, \"a\", 17);\n    i0.ɵɵlistener(\"click\", function HomeEditComponent_div_16_div_5_Template_a_click_2_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r5);\n      const homePhoto_r2 = restoredCtx.$implicit;\n      const ctx_r4 = i0.ɵɵnextContext(2);\n      return i0.ɵɵresetView(ctx_r4.deletePhoto(homePhoto_r2.id));\n    });\n    i0.ɵɵnamespaceSVG();\n    i0.ɵɵelementStart(3, \"svg\", 18);\n    i0.ɵɵelement(4, \"path\", 19)(5, \"path\", 20);\n    i0.ɵɵelementEnd()()();\n    i0.ɵɵnamespaceHTML();\n    i0.ɵɵelement(6, \"img\", 21);\n    i0.ɵɵelementEnd();\n  }\n  if (rf & 2) {\n    const homePhoto_r2 = ctx.$implicit;\n    const i_r3 = ctx.index;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(3, _c0, i_r3 === 0));\n    i0.ɵɵadvance(6);\n    i0.ɵɵpropertyInterpolate1(\"alt\", \"Home Image \", i_r3 + 1, \"\");\n    i0.ɵɵproperty(\"src\", homePhoto_r2.photo, i0.ɵɵsanitizeUrl);\n  }\n}\nfunction HomeEditComponent_div_16_Template(rf, ctx) {\n  if (rf & 1) {\n    i0.ɵɵelementStart(0, \"div\", 2)(1, \"label\", 11);\n    i0.ɵɵtext(2, \"Existing Photos\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(3, \"div\", 12)(4, \"div\", 13);\n    i0.ɵɵtemplate(5, HomeEditComponent_div_16_div_5_Template, 7, 5, \"div\", 14);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const ctx_r0 = i0.ɵɵnextContext();\n    i0.ɵɵadvance(5);\n    i0.ɵɵproperty(\"ngForOf\", ctx_r0.homePhotos);\n  }\n}\nexport let HomeEditComponent = /*#__PURE__*/(() => {\n  class HomeEditComponent {\n    constructor(fb, homeService, route, router) {\n      this.fb = fb;\n      this.homeService = homeService;\n      this.route = route;\n      this.router = router;\n      this.selectedFiles = [];\n      this.homePhotos = [];\n      this.photosToDelete = []; // Silinecek fotoğraf ID'lerini tutan dizi\n      this.updateForm = this.fb.group({\n        title: [''],\n        description: ['']\n      });\n      this.homeId = this.route.snapshot.params['id'];\n    }\n    ngOnInit() {\n      this.loadHomeDetails();\n    }\n    loadHomeDetails() {\n      this.homeService.gethomeById(this.homeId).subscribe({\n        next: response => {\n          console.log('Home Details:', response);\n          this.home = response;\n          // Formu güncelle\n          this.updateForm.patchValue({\n            title: response.title,\n            description: response.description\n          });\n          // Fotoğrafları al ve homePhotos dizisine ata\n          if (response.photos?.$values && Array.isArray(response.photos.$values)) {\n            // Fotoğrafları homePhotos dizisine ekle\n            this.homePhotos = response.photos.$values.map(photo => ({\n              id: photo.id,\n              photo: photo.photoUrl.startsWith('http://') ? photo.photoUrl.replace('http://', 'https://') : photo.photoUrl\n            }));\n            console.log('Home Photos:', this.homePhotos);\n          } else {\n            this.homePhotos = []; // Fotoğraflar yoksa boş bırak\n          }\n        },\n\n        error: err => {\n          console.error('Error fetching home details:', err);\n          alert('An error occurred while loading the home details.');\n        }\n      });\n    }\n    onFileSelected(event) {\n      this.selectedFiles = Array.from(event.target.files);\n    }\n    deletePhoto(id) {\n      console.log('Making DELETE request for photo with ID:', id); // Konsola ID yazdırma\n      // Fotoğrafı silme işlemi\n      this.homeService.deletePhoto(id).subscribe({\n        next: response => {\n          console.log('Fotoğraf başarıyla silindi:', response);\n          alert('Fotoğraf başarıyla silindi!');\n          // Fotoğrafı homePhotos dizisinden çıkarın\n          this.homePhotos = this.homePhotos.filter(photo => photo.id !== id);\n        },\n        error: err => {\n          console.error('Fotoğraf silinirken hata oluştu:', err);\n          alert('Fotoğraf silinirken bir hata oluştu.');\n        }\n      });\n    }\n    onSubmit() {\n      const formData = new FormData();\n      formData.append('title', this.updateForm.get('title')?.value || '');\n      formData.append('description', this.updateForm.get('description')?.value || '');\n      // Silinen fotoğrafları formData'ya ekleyin\n      formData.append('photosToDelete', JSON.stringify(this.photosToDelete));\n      // Yeni fotoğrafları ekleyin\n      for (const file of this.selectedFiles) {\n        formData.append('photos', file);\n      }\n      this.homeService.updateHome(this.homeId, formData).subscribe({\n        next: response => {\n          console.log('Update response:', response);\n          alert('Home updated successfully!');\n          this.router.navigate(['/admin/home/home-list']);\n        },\n        error: err => {\n          console.error('Error updating home:', err);\n          alert('An error occurred while updating the home.');\n        }\n      });\n    }\n    static {\n      this.ɵfac = function HomeEditComponent_Factory(t) {\n        return new (t || HomeEditComponent)(i0.ɵɵdirectiveInject(i1.FormBuilder), i0.ɵɵdirectiveInject(i2.HomeService), i0.ɵɵdirectiveInject(i3.ActivatedRoute), i0.ɵɵdirectiveInject(i3.Router));\n      };\n    }\n    static {\n      this.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n        type: HomeEditComponent,\n        selectors: [[\"app-home-edit\"]],\n        decls: 19,\n        vars: 2,\n        consts: [[1, \"container\"], [3, \"formGroup\", \"ngSubmit\"], [1, \"mb-3\"], [\"for\", \"title\", 1, \"form-label\"], [\"type\", \"text\", \"id\", \"title\", \"formControlName\", \"title\", 1, \"form-control\"], [\"for\", \"description\", 1, \"form-label\"], [\"id\", \"description\", \"formControlName\", \"description\", 1, \"form-control\"], [\"for\", \"photos\", 1, \"form-label\"], [\"type\", \"file\", \"id\", \"photos\", \"multiple\", \"\", 1, \"form-control\", 3, \"change\"], [\"class\", \"mb-3\", 4, \"ngIf\"], [\"type\", \"submit\", 1, \"btn\", \"btn-primary\"], [1, \"form-label\"], [\"id\", \"carouselExampleIndicators\", \"data-bs-ride\", \"carousel\", 1, \"carousel\", \"slide\"], [1, \"carousel-inner\"], [\"class\", \"carousel-item\", 3, \"ngClass\", 4, \"ngFor\", \"ngForOf\"], [1, \"carousel-item\", 3, \"ngClass\"], [1, \"d-block\", \"w-100\", \"ghost\"], [2, \"float\", \"right\", 3, \"click\"], [\"xmlns\", \"http://www.w3.org/2000/svg\", \"width\", \"27\", \"height\", \"27\", \"fill\", \"currentColor\", \"viewBox\", \"0 0 16 16\", 1, \"bi\", \"bi-trash\", 2, \"color\", \"red !important\"], [\"d\", \"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5m3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0z\"], [\"d\", \"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4zM2.5 3h11V2h-11z\"], [1, \"d-block\", \"w-100\", \"imageslide\", 2, \"height\", \"400px\", 3, \"src\", \"alt\"]],\n        template: function HomeEditComponent_Template(rf, ctx) {\n          if (rf & 1) {\n            i0.ɵɵelementStart(0, \"div\", 0)(1, \"h2\");\n            i0.ɵɵtext(2, \"Update Home\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(3, \"form\", 1);\n            i0.ɵɵlistener(\"ngSubmit\", function HomeEditComponent_Template_form_ngSubmit_3_listener() {\n              return ctx.onSubmit();\n            });\n            i0.ɵɵelementStart(4, \"div\", 2)(5, \"label\", 3);\n            i0.ɵɵtext(6, \"Titul\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(7, \"input\", 4);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(8, \"div\", 2)(9, \"label\", 5);\n            i0.ɵɵtext(10, \"M\\u0259lumat\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelement(11, \"textarea\", 6);\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(12, \"div\", 2)(13, \"label\", 7);\n            i0.ɵɵtext(14, \"Fotolar\");\n            i0.ɵɵelementEnd();\n            i0.ɵɵelementStart(15, \"input\", 8);\n            i0.ɵɵlistener(\"change\", function HomeEditComponent_Template_input_change_15_listener($event) {\n              return ctx.onFileSelected($event);\n            });\n            i0.ɵɵelementEnd()();\n            i0.ɵɵtemplate(16, HomeEditComponent_div_16_Template, 6, 1, \"div\", 9);\n            i0.ɵɵelementStart(17, \"button\", 10);\n            i0.ɵɵtext(18, \"Yenil\\u0259\");\n            i0.ɵɵelementEnd()()();\n          }\n          if (rf & 2) {\n            i0.ɵɵadvance(3);\n            i0.ɵɵproperty(\"formGroup\", ctx.updateForm);\n            i0.ɵɵadvance(13);\n            i0.ɵɵproperty(\"ngIf\", ctx.homePhotos.length > 0);\n          }\n        },\n        dependencies: [i4.NgClass, i4.NgForOf, i4.NgIf, i1.ɵNgNoValidate, i1.DefaultValueAccessor, i1.NgControlStatus, i1.NgControlStatusGroup, i1.FormGroupDirective, i1.FormControlName],\n        styles: [\".ghost[_ngcontent-%COMP%]{position:absolute;height:400px;padding:10px}\"]\n      });\n    }\n  }\n  return HomeEditComponent;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}